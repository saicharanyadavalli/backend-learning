<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Inventory Manager</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #e9f5f0 0%, #eef2f7 100%);
      --card-bg: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --primary: #10b981;
      --primary-dark: #059669;
      --ring: rgba(16, 185, 129, 0.25);
      --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
    }
    header {
      background: linear-gradient(90deg, #0ea5e9, #10b981);
      padding: 28px 20px;
      text-align: center;
      color: white;
      position: sticky;
      top: 0;
      z-index: 20;
      box-shadow: 0 8px 24px rgba(2, 6, 23, 0.15);
    }
    header h1 { margin: 0; font-weight: 700; letter-spacing: 0.3px; }
    header p { margin: 6px 0 0; opacity: 0.9; }
    .container {
      max-width: 1100px;
      margin: 28px auto;
      padding: 0 16px 24px;
    }
    .surface {
      background: var(--card-bg);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 22px;
    }
    h2 {
      color: #111827;
      font-size: 20px;
      margin: 0 0 14px 0;
      letter-spacing: 0.2px;
    }
    .grid-two {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px;
      margin-bottom: 22px;
    }
    @media (max-width: 800px) {
      .grid-two { grid-template-columns: 1fr; }
    }
    .section-card { padding: 18px; border: 1px solid #eef2f7; border-radius: 12px; }
    .section-desc { color: var(--muted); font-size: 14px; margin-top: 6px; }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 14px;
      margin-top: 12px;
    }
    .form-grid .full { grid-column: 1 / -1; }
    input, button {
      width: 100%;
      padding: 12px 12px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      outline: none;
      transition: all 0.15s ease;
      background: #fff;
    }
    input::placeholder { color: #9ca3af; }
    input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring);
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: var(--primary-dark); transform: translateY(-1px); }
    .danger { background: #ef4444; }
    .danger:hover { background: #dc2626; }
    .muted { background: #111827; }
    .muted:hover { background: #0b1220; }
    .product-section.surface { margin-top: 18px; }
    .product-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .product-card {
      background: linear-gradient(#ffffff, #ffffff) padding-box,
                  linear-gradient(135deg, rgba(99, 102, 241, 0.35), rgba(16, 185, 129, 0.35)) border-box;
      border: 1px solid transparent;
      padding: 16px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--shadow);
      text-align: center;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      color: #111827;
      font-weight: 600;
      letter-spacing: 0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .product-card:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(2, 6, 23, 0.12); }
    .empty-state { text-align: center; color: var(--muted); padding: 18px 0; }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(2, 6, 23, 0.55);
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .modal-content {
      background: #ffffff;
      padding: 20px 20px 16px;
      border-radius: 14px;
      width: 520px;
      max-width: 100%;
      box-shadow: 0 24px 64px rgba(2, 6, 23, 0.25);
      position: relative;
      animation: pop 0.18s ease-out;
    }
    @keyframes pop { from { transform: translateY(8px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 12px;
      cursor: pointer;
      color: #ef4444;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background 0.15s ease;
    }
    .close-btn:hover { background: #fee2e2; }
    .modal-content h3 { margin-top: 4px; margin-bottom: 8px; font-size: 22px; }
    .modal-content p { margin: 8px 0; color: #374151; }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Inventory Manager</h1>
    <p>Manage products effortlessly with a clean, modern interface</p>
  </header>
  <div class="container">
    <div class="grid-two">
      <div class="section-card surface">
        <h2>Add Product</h2>
        <p class="section-desc">Enter details and add a new product to your inventory.</p>
        <div class="form-grid">
          <input type="text" id="productname" placeholder="Product Name" class="full">
          <input type="text" id="productdesc" placeholder="Product Description" class="full">
          <input type="number" id="cost" placeholder="Cost">
          <input type="number" id="quantity" placeholder="Quantity">
          <input type="text" id="seller" placeholder="Seller Name" class="full">
          <button onclick="addProduct()" class="full">Add Product</button>
        </div>
      </div>
      <div class="section-card surface">
        <h2>Delete Product</h2>
        <p class="section-desc">Remove a product by its exact name.</p>
        <div class="form-grid">
          <input type="text" id="deleteName" placeholder="Product Name to Delete" class="full">
          <button onclick="deleteProduct()" class="danger full">Delete Product</button>
        </div>
      </div>
    </div>

    <div class="product-section surface">
      <h2>Product List</h2>
      <div class="product-list" id="productList"></div>
    </div>

  </div>

  <!-- Modal for Product Details -->
  <div class="modal" id="productModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">✖</span>
      <h3 id="modalName"></h3>
      <p><strong>Description:</strong> <span id="modalDesc"></span></p>
      <p><strong>Cost:</strong> ₹<span id="modalCost"></span></p>
      <p><strong>Quantity:</strong> <span id="modalQty"></span></p>
      <p><strong>Seller:</strong> <span id="modalSeller"></span></p>
      <p><strong>Added On:</strong> <span id="modalDate"></span></p>
    </div>
  </div>

  <script>
    const API_CANDIDATES = (() => {
      const list = [
        "http://127.0.0.1:8000",
        "http://localhost:8000"
      ];
      if (window.location && window.location.origin && window.location.origin.startsWith("http")) {
        // Prefer same-origin if you choose to serve backend and frontend together
        if (!list.includes(window.location.origin)) list.unshift(window.location.origin);
      }
      return list;
    })();
    let API_URL = localStorage.getItem("api_base") || API_CANDIDATES[0];

    async function ensureApi() {
      try {
        const probe = await fetch(`${API_URL}/inventory`, { method: "GET" });
        if (probe.ok) return API_URL;
      } catch (_) {}
      for (const base of API_CANDIDATES) {
        try {
          const res = await fetch(`${base}/inventory`, { method: "GET" });
          if (res.ok) {
            API_URL = base;
            localStorage.setItem("api_base", API_URL);
            return API_URL;
          }
        } catch (_) { /* try next */ }
      }
      // If we reach here, none worked; keep current to avoid undefined
      return API_URL;
    }

    async function fetchProducts() {
      await ensureApi();
      try {
        const res = await fetch(`${API_URL}/inventory`);
        const productList = document.getElementById("productList");
        productList.innerHTML = "";
        if (!res.ok) {
          productList.innerHTML = "<p class=\"empty-state\">Unable to load products.</p>";
          return;
        }
        const data = await res.json();
        if (!data || !Array.isArray(data.product_names) || data.product_names.length === 0) {
          productList.innerHTML = "<p class=\"empty-state\">No products found.</p>";
        } else {
          data.product_names.forEach(name => {
            const div = document.createElement("div");
            div.className = "product-card";
            div.innerText = name;
            div.onclick = () => showDetails(name);
            productList.appendChild(div);
          });
        }
      } catch (err) {
        console.error(err);
        const productList = document.getElementById("productList");
        productList.innerHTML = "<p class=\"empty-state\">Network error. Please try again.</p>";
      }
    }

    async function addProduct() {
      await ensureApi();
      const productname = document.getElementById("productname").value.trim();
      const productdesc = document.getElementById("productdesc").value.trim();
      const cost = document.getElementById("cost").value;
      const quantity = document.getElementById("quantity").value;
      const seller = document.getElementById("seller").value.trim();

      const parsedCost = parseInt(cost, 10);
      const parsedQuantity = parseInt(quantity, 10);

      if (!productname || !productdesc || !seller) {
        alert("Please fill in Product Name, Description, and Seller.");
        return;
      }
      if (!Number.isFinite(parsedCost) || parsedCost <= 0) {
        alert("Please enter a valid positive Cost.");
        return;
      }
      if (!Number.isFinite(parsedQuantity) || parsedQuantity <= 0) {
        alert("Please enter a valid positive Quantity.");
        return;
      }

      try {
        const res = await fetch(`${API_URL}/add`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            productname,
            productdesc,
            cost: parsedCost,
            quantity: parsedQuantity,
            seller
          })
        });

        if (res.status === 201) {
          alert("Product added successfully!");
          document.getElementById("productname").value = "";
          document.getElementById("productdesc").value = "";
          document.getElementById("cost").value = "";
          document.getElementById("quantity").value = "";
          document.getElementById("seller").value = "";
          fetchProducts();
        } else {
          alert("Error adding product!");
        }
      } catch (err) {
        console.error(err);
        alert("Network error while adding product.");
      }
    }

    async function deleteProduct() {
      await ensureApi();
      const name = document.getElementById("deleteName").value;
      try {
        const res = await fetch(`${API_URL}/delete/${encodeURIComponent(name)}`, { method: "DELETE" });
        if (res.status === 200) {
          alert("Product deleted successfully!");
          document.getElementById("deleteName").value = "";
          fetchProducts();
        } else if (res.status === 404) {
          alert("Product not found!");
        } else {
          alert("Unable to delete product.");
        }
      } catch (err) {
        console.error(err);
        alert("Network error while deleting product.");
      }
    }

    async function showDetails(name) {
      await ensureApi();
      try {
        const res = await fetch(`${API_URL}/inventory/${encodeURIComponent(name)}`);
        if (res.status === 200) {
          const data = await res.json();
          document.getElementById("modalName").innerText = data.productname;
          document.getElementById("modalDesc").innerText = data.productdesc;
          document.getElementById("modalCost").innerText = data.cost;
          document.getElementById("modalQty").innerText = data.quantity;
          document.getElementById("modalSeller").innerText = data.seller;
          document.getElementById("modalDate").innerText = data.orderdate;
          document.getElementById("productModal").style.display = "flex";
        } else if (res.status === 404) {
          alert("Product not found!");
        } else {
          alert("Unable to fetch product details.");
        }
      } catch (err) {
        console.error(err);
        alert("Network error while fetching details.");
      }
    }

    function closeModal() {
      document.getElementById("productModal").style.display = "none";
    }
    // Extra UX: close modal on overlay click or Esc key without changing existing function names
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeModal();
    });
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('productModal');
      if (e.target === modal) closeModal();
    });

    fetchProducts();
  </script>
</body>
</html>
